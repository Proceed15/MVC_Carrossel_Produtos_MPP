@model List<MeuSiteMVC.Models.CategoriaComProdutosViewModel>

@{
    ViewData["Title"] = "Vitrine de Produtos";
}

<h2>Vitrine de Produtos</h2>

@foreach (var grupo in Model)
{
    <h3 class="mt-5">@grupo.Categoria.Nome</h3>

    @if (grupo.Produtos.Any())
    {
        <div id="carousel@(grupo.Categoria.Id)" class="carousel slide mb-4" data-bs-ride="carousel">
            <div class="carousel-indicators">
                @for (int i = 0; i < grupo.Produtos.Count; i++)
                {
                    <button type="button" data-bs-target="#carousel@(grupo.Categoria.Id)" data-bs-slide-to="@i" class="@(i == 0 ? "active" : "")" aria-current="@(i == 0 ? "true" : "false")" aria-label="Slide @(i + 1)"></button>
                }
            </div>
            <div class="carousel-inner">
                @for (int i = 0; i < grupo.Produtos.Count; i++)
                {
                    var produto = grupo.Produtos[i];
                    <div class="carousel-item @(i == 0 ? "active" : "")">
                        <div class="card bg-light p-4 text-center">
                            <!-- Imagem do produto (com fallback) -->
                            @if (!string.IsNullOrEmpty(produto.ImagemUrl))
                            {
                                <img src="@produto.ImagemUrl" class="img-fluid mb-3" style="max-height: 200px; object-fit: contain;" alt="@produto.Nome" />
                            }
                            else
                            {
                                <div class="text-muted mb-3">Sem imagem</div>
                            }

                            <h5>@produto.Nome</h5>
                            <p class="small">@produto.Descricao</p>
                            <p class="text-success fw-bold">R$ @produto.Preco.ToString("N2")</p>
                            <a href="/Produtos/Detalhes/@produto.Id" class="btn btn-outline-primary">Ver detalhes</a>
                        </div>
                    </div>
                }
            </div>
            @if (grupo.Produtos.Count > 1)
            {
                <button class="carousel-control-prev" type="button" data-bs-target="#carousel@(grupo.Categoria.Id)" data-bs-slide="prev">
                    <span class="carousel-control-prev-icon" aria-hidden="true"></span>
                    <span class="visually-hidden">Anterior</span>
                </button>
                <button class="carousel-control-next" type="button" data-bs-target="#carousel@(grupo.Categoria.Id)" data-bs-slide="next">
                    <span class="carousel-control-next-icon" aria-hidden="true"></span>
                    <span class="visually-hidden">Próximo</span>
                </button>
            }
        </div>
    }
    else
    {
        <p>Nenhum produto disponível nesta categoria.</p>
    }
}